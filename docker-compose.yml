version: '3.8'

services:
  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
      args:
        VITE_API_URL: ${VITE_API_URL:-http://localhost:5000}
        VITE_ENV: ${VITE_ENV:-production}
    ports:
      - "5173:80"
    depends_on:
      - backend
    networks:
      - calance-network

  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    ports:
      - "5000:5000"
    environment:
      - FLASK_ENV=${FLASK_ENV:-development}
      - FLASK_DEBUG=${FLASK_DEBUG:-True}
      - OPENROUTER_API_KEY=${OPENROUTER_API_KEY}
      - OPENROUTER_BASE_URL=${OPENROUTER_BASE_URL:-https://openrouter.ai/api/v1}
      - MODEL_CASE_STUDY_ANALYSIS=${MODEL_CASE_STUDY_ANALYSIS:-anthropic/claude-sonnet-4.5}
      - MODEL_CASE_STUDY_IMAGE=${MODEL_CASE_STUDY_IMAGE:-google/gemini-3-pro-image-preview}
      - MODEL_CASE_STUDY_REFINEMENT=${MODEL_CASE_STUDY_REFINEMENT:-anthropic/claude-sonnet-4.5}
      - MODEL_PRESENTATION_GENERATION=${MODEL_PRESENTATION_GENERATION:-google/gemini-2.5-flash-image-preview}
      - MODEL_PRESENTATION_REFINEMENT=${MODEL_PRESENTATION_REFINEMENT:-anthropic/claude-sonnet-4.5}
      - MODEL_RECRUITING_GENERATION=${MODEL_RECRUITING_GENERATION:-anthropic/claude-haiku-4.5}
      - CORS_ORIGINS=${CORS_ORIGINS:-http://localhost:3000,http://127.0.0.1:3000,http://localhost:5173,http://127.0.0.1:5173,http://localhost:5174,http://127.0.0.1:5174,http://localhost:5175,http://127.0.0.1:5175,http://localhost:5176,http://127.0.0.1:5176}
    volumes:
      - ./backend:/app
    networks:
      - calance-network

networks:
  calance-network:
    driver: bridge

volumes:
  node_modules: